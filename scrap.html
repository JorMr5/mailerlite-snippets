<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora de Coste de Scrap â€” inyec.pro</title>

<!-- FUENTES: usa sistema para que cargue rÃ¡pido -->
<style>
:root{
  --bg:#0b0f10;
  --card:#071318;
  --muted:#aebfbb;
  --accent:#5cbcae;
  --glass: rgba(255,255,255,0.03);
  --glass-2: rgba(92,188,174,0.06);
}
*{box-sizing:border-box}
body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071118 0,#071016 100%);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#eaf6f2;padding:28px}
.container{width:100%;max-width:900px;margin:auto;}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));border-radius:14px;padding:22px;box-shadow:0 12px 30px rgba(2,6,8,0.6);border:1px solid rgba(255,255,255,0.02)}
.header{display:flex;align-items:center;gap:16px}
.logo{
  width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#3fb3a0);display:flex;align-items:center;justify-content:center;font-weight:800;color:#062a25;font-size:20px;box-shadow:0 6px 18px rgba(92,188,174,0.08)
}
.title{flex:1}
.title h1{margin:0;font-size:20px;color:var(--accent)}
.title p{margin:4px 0 0 0;color:var(--muted);font-size:13px}

/* inputs grid */
.inputs-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:18px}
.field{display:flex;flex-direction:column}
label{font-size:13px;color:var(--muted);margin-bottom:6px;font-weight:600}
input[type=number],input[type=email]{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:#fff;color:#0b1212;font-size:15px}
.small{font-size:12px;color:#9fbfb9;margin-top:8px}

/* buttons */
.row-actions{display:flex;gap:12px;align-items:center;margin-top:14px}
.btn{background:var(--accent);color:#042623;padding:11px 14px;border-radius:10px;border:none;font-weight:800;cursor:pointer;flex:1;box-shadow:0 8px 18px rgba(92,188,174,0.08)}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);flex:0 0 auto;padding:10px 12px}

/* results grid */
.results-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:18px}
.result-card{background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(0,0,0,0.02));border:1px solid rgba(255,255,255,0.03);padding:14px;border-radius:12px;min-height:72px;position:relative;overflow:hidden}
.result-card .label{font-size:13px;color:var(--muted)}
.result-card .value{font-size:20px;font-weight:800;margin-top:8px;color:#eaf6f2;filter:blur(6px);transition:filter .35s, transform .25s}
.result-card .value.unblur{filter:none;transform:translateY(0)}
.lock-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}

/* email gate */
.email-gate{margin-top:18px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));border:1px solid rgba(92,188,174,0.04);display:flex;gap:12px;align-items:center}
.email-gate .info{flex:1}
.email-gate input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06)}

/* small responsive */
@media (max-width:720px){
  .inputs-grid{grid-template-columns:1fr}
  .results-grid{grid-template-columns:1fr}
  .header{gap:10px}
  .logo{width:48px;height:48px}
}

.footer-note{margin-top:12px;font-size:12px;color:#93bfb2}
</style>
</head>
<body>
<div class="container">
  <div class="card" role="application" aria-label="Calculadora de Scrap">
    <div class="header">
      <div class="logo">iny</div>
      <div class="title">
        <h1>Calculadora de Coste de Scrap</h1>
        <p>Introduce los datos reales de tu lÃ­nea y descubre el impacto econÃ³mico.</p>
      </div>
      <div style="text-align:right;font-size:13px;color:var(--muted);min-width:90px">members.inyec.pro</div>
    </div>

    <form id="calcForm" onsubmit="return false;" aria-hidden="false">
      <div class="inputs-grid" role="group" aria-label="Entradas de calculadora">
        <div class="field">
          <label for="piecesHour">Piezas / hora</label>
          <input id="piecesHour" type="number" inputmode="numeric" placeholder="Ej. 120" />
          <div class="small">ProducciÃ³n por mÃ¡quina</div>
        </div>

        <div class="field">
          <label for="weightGrams">Peso por pieza (g)</label>
          <input id="weightGrams" type="number" inputmode="numeric" placeholder="Ej. 10" />
          <div class="small">Valor en gramos</div>
        </div>

        <div class="field">
          <label for="scrapPct">% Scrap</label>
          <input id="scrapPct" type="number" inputmode="numeric" placeholder="Ej. 2" />
          <div class="small">Porcentaje de piezas defectuosas</div>
        </div>

        <div class="field">
          <label for="priceKg">â‚¬/kg materia prima</label>
          <input id="priceKg" type="number" inputmode="numeric" step="0.01" placeholder="Ej. 2.50" />
          <div class="small">Precio material</div>
        </div>
      </div>

      <div class="row-actions">
        <button class="btn" id="btnCalculate" type="button">Calcular</button>
        <button class="btn ghost" id="btnReset" type="button">Reset</button>
      </div>
    </form>

    <div class="results-grid" aria-live="polite" aria-atomic="true">
      <div class="result-card" id="cardHour">
        <div class="label">â‚¬ / Hora</div>
        <div id="valHour" class="value">â€”</div>
        <div class="lock-overlay" id="overlayHour"></div>
      </div>

      <div class="result-card" id="cardDay">
        <div class="label">â‚¬ / DÃ­a (8h)</div>
        <div id="valDay" class="value">â€”</div>
        <div class="lock-overlay" id="overlayDay"></div>
      </div>

      <div class="result-card" id="cardMonth">
        <div class="label">â‚¬ / Mes (22d)</div>
        <div id="valMonth" class="value">â€”</div>
        <div class="lock-overlay" id="overlayMonth"></div>
      </div>

      <div class="result-card" id="cardYear">
        <div class="label">â‚¬ / AÃ±o</div>
        <div id="valYear" class="value">â€”</div>
        <div class="lock-overlay" id="overlayYear"></div>
      </div>
    </div>

    <div class="email-gate" id="emailGate" role="region" aria-label="Desbloquear resultados">
      <div class="info">
        <div style="font-weight:700;color:#eaf6f2">ðŸ”’ Resultados bloqueados</div>
        <div class="small">Introduce tu correo para desbloquear los resultados y recibir un informe con recomendaciones.</div>
      </div>
      <input id="userEmail" type="email" placeholder="tu@empresa.com" aria-label="Email para desbloquear" />
      <button class="btn" id="btnUnlock">Desbloquear</button>
    </div>

    <div class="footer-note">Opcional: tras desbloquear, integraremos la captura en MailerLite o webhooks.</div>
  </div>
</div>

<script>
/* Variables DOM */
const piecesHour = document.getElementById('piecesHour');
const weightGrams = document.getElementById('weightGrams');
const scrapPct = document.getElementById('scrapPct');
const priceKg = document.getElementById('priceKg');

const valHour = document.getElementById('valHour');
const valDay = document.getElementById('valDay');
const valMonth = document.getElementById('valMonth');
const valYear = document.getElementById('valYear');

const btnCalc = document.getElementById('btnCalculate');
const btnReset = document.getElementById('btnReset');
const btnUnlock = document.getElementById('btnUnlock');
const emailGate = document.getElementById('emailGate');
const userEmail = document.getElementById('userEmail');

let computed = { h:0, d:0, m:0, y:0 };

/* Formulas: costeâ‚¬/h = piezas_hora * (scrap%/100) * (peso_g/1000) * â‚¬/kg */
function computeValues(){
  const ph = Number(piecesHour.value);
  const wg = Number(weightGrams.value);
  const sp = Number(scrapPct.value) / 100;
  const pk = Number(priceKg.value);

  if (![ph,wg,sp,pk].every(v => Number.isFinite(v) && v > 0)) {
    return null;
  }

  const costPerHour = ph * sp * (wg / 1000) * pk;
  const costPerDay = costPerHour * 8;
  const costPerMonth = costPerDay * 22;
  const costPerYear = costPerMonth * 12;

  return { h: costPerHour, d: costPerDay, m: costPerMonth, y: costPerYear };
}

function formatEUR(n){
  return n.toLocaleString('es-ES',{style:'currency',currency:'EUR',maximumFractionDigits:2});
}

/* Counter animation */
function animateValue(el, end, duration = 900){
  const start = 0;
  const range = end - start;
  const steps = Math.max(12, Math.round(duration / 20));
  let current = 0;
  let step = 0;
  const timer = setInterval(() => {
    step++;
    const progress = step / steps;
    const eased = 1 - Math.pow(1 - progress, 3); // easeOutCubic
    current = start + range * eased;
    el.textContent = formatEUR(current);
    if (step >= steps) {
      clearInterval(timer);
      el.textContent = formatEUR(end);
    }
  }, 20);
}

/* Show blurred placeholders (computed but blurred) */
function showPlaceholders(vals){
  if(!vals) return;
  valHour.textContent = formatEUR(vals.h);
  valDay.textContent = formatEUR(vals.d);
  valMonth.textContent = formatEUR(vals.m);
  valYear.textContent = formatEUR(vals.y);

  // keep blurred until unlock
  [valHour,valDay,valMonth,valYear].forEach(v => v.classList.remove('unblur'));
}

/* Unlock: animate and reveal */
function unlockAndAnimate(){
  const vals = computed;
  if(!vals) return;
  [valHour,valDay,valMonth,valYear].forEach(v => v.classList.add('unblur')); // remove blur visually
  animateValue(valHour, vals.h, 900);
  animateValue(valDay, vals.d, 1000);
  animateValue(valMonth, vals.m, 1200);
  animateValue(valYear, vals.y, 1400);
}

/* Events */
btnCalc.addEventListener('click', () => {
  const vals = computeValues();
  if(!vals){ alert('Rellena correctamente todos los campos (valores mayores que 0).'); return; }
  computed = vals;
  showPlaceholders(vals);
});

btnReset.addEventListener('click', () => {
  piecesHour.value = '';
  weightGrams.value = '';
  scrapPct.value = '';
  priceKg.value = '';
  computed = { h:0, d:0, m:0, y:0 };
  [valHour,valDay,valMonth,valYear].forEach(v => { v.textContent = 'â€”'; v.classList.remove('unblur'); });
  emailGate.style.display = '';
});

btnUnlock.addEventListener('click', () => {
  const mail = (userEmail.value || '').trim();
  if(!mail || mail.indexOf('@') < 0){ alert('Introduce un email vÃ¡lido.'); return; }
  // opcional: aquÃ­ puedes enviar el email a tu API / MailerLite webhook por fetch
  try { localStorage.setItem('inyec_scrap_email', mail); } catch(e){}
  unlockAndAnimate();
  emailGate.style.display = 'none';
});

/* Accessibility: press Enter to calculate when in an input */
['piecesHour','weightGrams','scrapPct','priceKg','userEmail'].forEach(id=>{
  const el = document.getElementById(id);
  if(el) el.addEventListener('keydown', e => { if(e.key === 'Enter') btnCalc.click(); });
});
</script>
</body>
</html>
