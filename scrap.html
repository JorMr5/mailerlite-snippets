<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora Premium - Coste de Scrap</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#000000;
  --accent:#5cbcae;
  --muted:#8fbfb2;
  --glass: rgba(255,255,255,0.03);
  --block:#071015;
  --card-border: rgba(92,188,174,0.12);
  --text:#e6f7f2;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  padding:26px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* subtle grid lines background for neon HUD */
.bg-grid{
  position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:
    linear-gradient(rgba(255,255,255,0.01) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.01) 1px, transparent 1px);
  background-size: 44px 44px, 44px 44px;
  opacity:0.06;
}

/* Main container */
.wrap{
  width:100%;
  max-width:980px;
  z-index:1;
}
.shell{
  border-radius:14px;
  padding:20px;
  background: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(0,0,0,0.06));
  border:1px solid rgba(255,255,255,0.02);
  box-shadow: 0 20px 50px rgba(0,0,0,0.7);
  display:grid;
  grid-template-columns: 1fr;
  gap:18px;
  position:relative;
  overflow:hidden;
}

/* Neon accents top */
.header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
}
.title{
  font-weight:800;
  color:var(--accent);
  font-size:22px;
  letter-spacing:0.6px;
  font-family: "Space Mono", monospace;
  display:flex;
  align-items:center;
  gap:12px;
}
.title .dash{
  width:40px;height:2px;background:linear-gradient(90deg, rgba(92,188,174,0.9), rgba(92,188,174,0.35));
  box-shadow:0 0 18px rgba(92,188,174,0.12), 0 0 60px rgba(92,188,174,0.02) inset;
  transform:translateY(2px);
}
.subtitle{color:var(--muted);font-size:13px;margin-top:4px}

/* Main area: two cards (inputs + results) */
.area{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:18px;
}

/* Card base */
.card{
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));
  border-radius:12px;
  padding:16px;
  border:1px solid rgba(255,255,255,0.02);
  position:relative;
  overflow:hidden;
}

/* Left - Inputs */
.inputs-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.field{
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));
  border-radius:10px;
  padding:12px;
  border:1px solid rgba(255,255,255,0.02);
  position:relative;
  box-shadow: 0 6px 18px rgba(0,0,0,0.6) inset;
}
.field label{
  font-size:13px;color:var(--muted);font-weight:700;margin-bottom:8px;display:block;
}
.field input{
  background:#020404;color:var(--text);border:1px solid rgba(255,255,255,0.03);
  padding:12px;border-radius:8px;font-size:17px;
  box-shadow:0 6px 18px rgba(92,188,174,0.02) inset;
  transition: box-shadow .18s, transform .12s;
  width:100%;
}

/* Terminal-Tech feel: focus glow */
.field input:focus{
  outline:none;
  box-shadow: 0 0 24px rgba(92,188,174,0.18), 0 6px 18px rgba(92,188,174,0.04) inset;
  transform: translateY(-1px);
}

/* Buttons */
.actions{display:flex;gap:12px;margin-top:12px}
.btn{
  background:var(--accent);color:#021916;border:0;padding:12px 14px;border-radius:10px;font-weight:800;font-size:15px;cursor:pointer;
  box-shadow: 0 10px 30px rgba(92,188,174,0.06);
}
.btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.02)}

/* Right - Results (cyber blocks) */
.results-grid{display:grid;grid-template-columns:repeat(1,1fr);gap:12px}
.result{
  background: linear-gradient(180deg, rgba(10,16,18,0.6), rgba(7,11,12,0.4));
  border-radius:10px;padding:14px;border:1px solid var(--card-border);
  position:relative;overflow:hidden;min-height:78px;
  box-shadow: 0 8px 28px rgba(0,0,0,0.6);
}
.result .label{font-size:13px;color:var(--muted);font-weight:700}
.result .value{font-size:24px;font-weight:800;color:var(--text);margin-top:8px}

/* cyber detail lines */
.result:before, .result:after{
  content:"";position:absolute;inset:0;border-radius:10px;pointer-events:none;
}
.result:before{
  background: linear-gradient(90deg, rgba(92,188,174,0.03), transparent 20%, transparent 80%, rgba(92,188,174,0.02));
  mix-blend-mode: overlay; opacity:0.7;
}
.result:after{
  background-image: linear-gradient(0deg, rgba(255,255,255,0.01) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.01) 1px, transparent 1px);
  background-size: 40px 40px, 40px 40px;
  opacity:0.03;
}

/* Light sweep diagonal (animation) */
.sweep{
  position:absolute;inset:-40%  -40% -40% -40%;
  transform:rotate(-18deg);
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.04) 45%, rgba(255,255,255,0) 100%);
  mix-blend-mode: screen;
  animation: sweep 3.8s linear infinite;
  opacity:0.7;
}
@keyframes sweep{
  0%{ transform: translateX(-110%) rotate(-18deg); }
  50%{ transform: translateX(110%) rotate(-18deg); }
  100%{ transform: translateX(320%) rotate(-18deg); }
}

/* glow pulse */
@keyframes pulseGlow{
  0%{ box-shadow: 0 6px 30px rgba(92,188,174,0.04); }
  50%{ box-shadow: 0 10px 40px rgba(92,188,174,0.14); }
  100%{ box-shadow: 0 6px 30px rgba(92,188,174,0.04); }
}

/* large typography */
.title { font-size:24px; }
.field input { font-size:18px; padding:14px; }
.result .value { font-size:26px; }

/* email gate */
.email-gate{
  margin-top:12px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));
}
.email-row{display:flex;gap:10px;align-items:center}
.email-row input{flex:1;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:#010202;color:var(--text);font-size:16px}
.consent{display:flex;gap:10px;align-items:flex-start;margin-top:8px;color:var(--muted);font-size:13px}
.download{margin-top:10px;display:flex;gap:10px}

/* responsive */
@media (max-width:900px){
  .area{grid-template-columns:1fr}
  .results-grid{grid-template-columns:1fr 1fr}
}
@media (max-width:520px){
  .inputs-grid{grid-template-columns:1fr}
  .results-grid{grid-template-columns:1fr}
  .title{font-size:20px}
}
</style>
</head>
<body>
<div class="bg-grid" aria-hidden="true"></div>

<div class="wrap">
  <div class="shell" role="application" aria-label="Calculadora de scrap premium">
    <div class="header">
      <div>
        <div class="title"><span class="dash"></span> SCRAP CALC</div>
        <div class="subtitle">Calcula el coste real del scrap â€” desbloquea cifras y reduce pÃ©rdidas</div>
      </div>
      <div style="font-size:12px;color:var(--muted);font-weight:700;align-self:center">inyec.pro</div>
    </div>

    <div class="area">
      <!-- left card: inputs -->
      <div class="card" aria-labelledby="inputsTitle">
        <div id="inputsTitle" style="font-weight:800;font-size:15px;color:var(--accent);margin-bottom:10px">Entradas</div>

        <div class="inputs-grid" role="region" aria-label="Entradas">
          <div class="field">
            <label for="pieces">Piezas / hora</label>
            <input id="pieces" type="number" inputmode="numeric" min="0" placeholder="Ej. 120" aria-label="Piezas por hora">
          </div>

          <div class="field">
            <label for="weight">Peso pieza (g)</label>
            <input id="weight" type="number" inputmode="numeric" min="0" placeholder="Ej. 34" aria-label="Peso pieza en gramos">
          </div>

          <div class="field">
            <label for="scrap"> % Scrap</label>
            <input id="scrap" type="number" inputmode="numeric" min="0" max="100" step="0.01" placeholder="Ej. 2.5" aria-label="Porcentaje de scrap">
          </div>

          <div class="field">
            <label for="price">Precio â‚¬/kg (granza)</label>
            <input id="price" type="number" inputmode="numeric" min="0" step="0.01" placeholder="Ej. 2.50" aria-label="Precio euros por kilogramo">
          </div>
        </div>

        <div class="actions" role="group" aria-label="acciones">
          <button class="btn" id="calc">Calcular</button>
          <button class="btn ghost" id="reset">Reset</button>
        </div>

        <div class="email-gate" aria-hidden="false">
          <div style="font-weight:700;color:var(--muted);margin-bottom:6px">ðŸ”’ Desbloquea resultados</div>
          <div class="email-row">
            <input id="email" type="email" placeholder="tu@empresa.com" aria-label="email">
            <button class="btn" id="unlock">Desbloquear</button>
          </div>
          <div class="consent">
            <input id="consent" type="checkbox" aria-label="consentimiento">
            <div style="max-width:82%">Acepto que mi correo se incluya en la lista de correo de inyec.pro y recibir comunicaciones relacionadas. Puedo darme de baja en cualquier momento.</div>
          </div>
          <div class="download" aria-hidden="true">
            <button class="btn ghost" id="download" style="display:none">Descargar CSV</button>
          </div>
        </div>
      </div>

      <!-- right card: results -->
      <div class="card" aria-labelledby="resultsTitle">
        <div id="resultsTitle" style="font-weight:800;font-size:15px;color:var(--accent);margin-bottom:10px">Resultados (bloqueados)</div>

        <div class="results-grid" role="region" aria-label="Resultados">
          <div class="result" id="rHourCard">
            <div class="sweep" aria-hidden="true"></div>
            <div class="label">PÃ©rdida â‚¬ / Hora</div>
            <div class="value" id="vHour">â€”</div>
          </div>

          <div class="result" id="rDayCard">
            <div class="sweep" aria-hidden="true"></div>
            <div class="label">PÃ©rdida â‚¬ / DÃ­a (24h)</div>
            <div class="value" id="vDay">â€”</div>
          </div>

          <div class="result" id="rMonthCard">
            <div class="sweep" aria-hidden="true"></div>
            <div class="label">PÃ©rdida â‚¬ / Mes (30d)</div>
            <div class="value" id="vMonth">â€”</div>
          </div>

          <div class="result" id="rYearCard">
            <div class="sweep" aria-hidden="true"></div>
            <div class="label">PÃ©rdida â‚¬ / AÃ±o</div>
            <div class="value" id="vYear">â€”</div>
          </div>
        </div>

        <div style="margin-top:12px" class="small">Introduce valores y pulsa <strong>Calcular</strong>. Los resultados estÃ¡n difuminados; para ver cifras exactas introduce tu email y acepta el consentimiento.</div>
      </div>
    </div>

  </div>
</div>

<script>
/* Config */
const webhookURL = "https://hook.eu2.make.com/axx0jrw2x1cul6e8shm7hs6ucfg7l6of";

/* DOM */
const $ = id => document.getElementById(id);
const pieces = $("pieces"), weight = $("weight"), scrap = $("scrap"), price = $("price");
const calcBtn = $("calc"), resetBtn = $("reset"), unlockBtn = $("unlock"), emailI = $("email"), consent = $("consent");
const vHour = $("vHour"), vDay = $("vDay"), vMonth = $("vMonth"), vYear = $("vYear");
const downloadBtn = $("download");
let computed = null;

/* Formatting */
function fmt(v){ return Number(v).toLocaleString('es-ES',{style:'currency',currency:'EUR',maximumFractionDigits:2}); }

/* Validate */
function validate(){
  const p = Number(pieces.value), w = Number(weight.value), s = Number(scrap.value), pr = Number(price.value);
  if(!isFinite(p) || p<=0) return {ok:false,msg:"Piezas / hora debe ser > 0"};
  if(!isFinite(w) || w<=0) return {ok:false,msg:"Peso pieza (g) debe ser > 0"};
  if(!isFinite(s) || s<0 || s>100) return {ok:false,msg:"% Scrap entre 0 y 100"};
  if(!isFinite(pr) || pr<=0) return {ok:false,msg:"Precio â‚¬/kg debe ser > 0"};
  return {ok:true,p,w,s,pr};
}

/* Compute (correct formulas) */
function computeValues(){
  const v = validate();
  if(!v.ok){ alert(v.msg); return null; }
  const piecesPerHour = v.p;
  const weightKg = v.w / 1000;
  const scrapFrac = v.s / 100;
  const priceKg = v.pr;

  const lostKgHour = piecesPerHour * scrapFrac * weightKg; // kg per hour lost
  const costHour = lostKgHour * priceKg;
  const costDay = costHour * 24;
  const costMonth = costDay * 30;
  const costYear = costDay * 365;

  return {costHour, costDay, costMonth, costYear};
}

/* Show blurred placeholders (no unlock) */
function showPlaceholders(vals){
  if(!vals) return;
  vHour.textContent = fmt(vals.costHour);
  vDay.textContent = fmt(vals.costDay);
  vMonth.textContent = fmt(vals.costMonth);
  vYear.textContent = fmt(vals.costYear);
  // remove unlocked class
  [vHour,vDay,vMonth,vYear].forEach(e => e.classList.remove("unlocked"));
  computed = vals;
}

/* Animate unlock */
function animateAndUnlock(){
  if(!computed) return;
  const list = [
    [vHour, computed.costHour, 900],
    [vDay, computed.costDay, 1100],
    [vMonth, computed.costMonth, 1300],
    [vYear, computed.costYear, 1500]
  ];
  list.forEach(([el,end,dur]) => animate(el,end,dur));
  [vHour,vDay,vMonth,vYear].forEach(e => e.classList.add("unlocked"));
}

/* Counter animation (easeOutCubic) */
function animate(el, end, duration=1000){
  const start = 0;
  const steps = Math.max(12, Math.round(duration/20));
  let step = 0;
  const timer = setInterval(()=>{
    step++;
    const t = step/steps;
    const eased = 1 - Math.pow(1 - t, 3);
    const v = start + (end - start) * eased;
    el.textContent = fmt(v);
    if(step >= steps){ clearInterval(timer); el.textContent = fmt(end); }
  }, 20);
}

/* Send email to Make webhook */
async function sendWebhook(email){
  try{
    const res = await fetch(webhookURL, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ email, source: "calculadora_scrap" })
    });
    return res.ok;
  }catch(e){
    console.warn("Webhook error", e);
    return false;
  }
}

/* Events */
calcBtn.addEventListener('click', () => {
  const vals = computeValues();
  if(!vals) return;
  showPlaceholders(vals);
  // subtle pulse on cards
  document.querySelectorAll('.result').forEach(c => { c.style.animation = "pulseGlow 1.6s ease-in-out"; setTimeout(()=>c.style.animation = "",1600); });
});

resetBtn.addEventListener('click', () => {
  pieces.value = ""; weight.value = ""; scrap.value = ""; price.value = "";
  emailI.value = ""; consent.checked = false;
  computed = null;
  [vHour,vDay,vMonth,vYear].forEach(e => { e.textContent = "â€”"; e.classList.remove("unlocked"); });
});

unlockBtn.addEventListener('click', async () => {
  if(!computed){ alert("Calcula primero para desbloquear."); return; }
  const mail = emailI.value.trim();
  if(!mail || mail.indexOf('@')<0){ alert("Introduce un email vÃ¡lido."); return; }
  if(!consent.checked){ alert("Debes aceptar el consentimiento."); return; }

  unlockBtn.disabled = true; unlockBtn.textContent = "Enviando...";
  const ok = await sendWebhook(mail);
  // We proceed regardless of ok to keep UX smooth
  setTimeout(()=>{ unlockBtn.disabled=false; unlockBtn.textContent = "Desbloquear"; }, 900);
  animateAndUnlock();
  downloadBtn.style.display = "inline-block";
});

/* download CSV */
downloadBtn.addEventListener('click', () => {
  if(!computed) return;
  const rows = [
    ["Metric","Value (â‚¬)"],
    ["Coste / Hora", computed.costHour.toFixed(2)],
    ["Coste / DÃ­a (24h)", computed.costDay.toFixed(2)],
    ["Coste / Mes (30d)", computed.costMonth.toFixed(2)],
    ["Coste / AÃ±o", computed.costYear.toFixed(2)]
  ];
  const csv = rows.map(r => r.join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = "informe_scrap.csv"; document.body.appendChild(a); a.click(); a.remove();
});

/* Accessibility: Enter key */
document.addEventListener('keydown', (e) => {
  if(e.key === 'Enter'){
    const active = document.activeElement;
    if([pieces,weight,scrap,price].includes(active)) calcBtn.click();
    if(active === emailI) unlockBtn.click();
  }
});
</script>
</body>
</html>
