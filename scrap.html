<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora de Scrap Premium</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#000000;
  --accent:#5cbcae;
  --muted:#8fbfb2;
  --glass: rgba(255,255,255,0.03);
  --block:#071015;
  --card-border: rgba(92,188,174,0.18);
  --text:#e6f7f2;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  padding:26px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.bg-grid{
  position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:
    linear-gradient(rgba(255,255,255,0.015) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.015) 1px, transparent 1px);
  background-size: 44px 44px, 44px 44px;
  opacity:0.06;
}

.wrap{
  width:100%;
  max-width:980px;
  z-index:1;
}
.shell{
  border-radius:14px;
  padding:20px;
  background: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(0,0,0,0.06));
  border:1px solid rgba(255,255,255,0.02);
  box-shadow: 0 20px 50px rgba(0,0,0,0.7);
  display:grid;
  grid-template-columns: 1fr;
  gap:18px;
  position:relative;
  overflow:hidden;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
}
.title{
  font-weight:800;
  color:var(--accent);
  font-size:24px;
  letter-spacing:0.4px;
  font-family: "Space Mono", monospace;
  display:flex;
  align-items:center;
  gap:10px;
}
.title .dash{
  width:36px;height:2px;
  background:linear-gradient(90deg, rgba(92,188,174,0.9), rgba(92,188,174,0.3));
  box-shadow:0 0 14px rgba(92,188,174,0.25);
}
.subtitle{color:var(--muted);font-size:13px;margin-top:4px}

.area{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:18px;
}

/* card styling */
.card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));
  border-radius:12px;
  padding:16px;
  border:1px solid rgba(255,255,255,0.04);
  position:relative;
  overflow:hidden;
  box-shadow:0 0 20px rgba(92,188,174,0.04);
}

/* inputs */
.inputs-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.field{
  background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(0,0,0,0.04));
  border-radius:10px;
  padding:12px;
  border:1px solid rgba(255,255,255,0.03);
  position:relative;
}
.field label{
  font-size:13px;color:var(--muted);font-weight:700;margin-bottom:8px;display:block;
}
.field input{
  background:#020404;color:var(--text);border:1px solid rgba(255,255,255,0.03);
  padding:14px;border-radius:8px;font-size:18px;
  transition: box-shadow .18s, transform .12s;
  width:100%;
}
.field input:focus{
  outline:none;
  box-shadow: 0 0 14px rgba(92,188,174,0.25), 0 0 4px rgba(92,188,174,0.12) inset;
  transform: translateY(-1px);
}

/* buttons */
.actions{display:flex;gap:12px;margin-top:12px}
.btn{
  background:var(--accent);color:#021916;border:0;padding:12px 14px;border-radius:10px;font-weight:800;font-size:16px;cursor:pointer;
  box-shadow:0 10px 26px rgba(92,188,174,0.15);
}
.btn.ghost{
  background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.05)
}

/* email gate */
.email-gate{
  margin-top:12px;padding:12px;border-radius:10px;
  border:1px solid rgba(255,255,255,0.03);
  background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(0,0,0,0.04));
}
.email-row{display:flex;gap:10px;align-items:center}
.email-row input{
  flex:1;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:#010202;color:var(--text);font-size:16px
}
.consent{
  display:flex;gap:10px;align-items:flex-start;margin-top:8px;color:var(--muted);font-size:13px
}
.download{
  margin-top:10px;display:flex;gap:10px
}

/* results */
.results-grid{display:grid;grid-template-columns:repeat(1,1fr);gap:14px}
.result{
  background: linear-gradient(180deg, rgba(10,16,18,0.65), rgba(7,11,12,0.5));
  border-radius:10px;padding:14px;border:1px solid var(--card-border);
  position:relative;overflow:hidden;min-height:78px;
  box-shadow:0 0 18px rgba(92,188,174,0.05);
}

/* glow dynamic animation */
@keyframes glow{
  0%{ box-shadow:0 0 10px rgba(92,188,174,0.05); border-color:rgba(92,188,174,0.12); }
  50%{ box-shadow:0 0 22px rgba(92,188,174,0.18); border-color:rgba(92,188,174,0.22); }
  100%{ box-shadow:0 0 10px rgba(92,188,174,0.05); border-color:rgba(92,188,174,0.12); }
}
.result{
  animation: glow 4s ease-in-out infinite;
}

.label{font-size:13px;color:var(--muted);font-weight:700}
.value{font-size:26px;font-weight:800;color:var(--text);margin-top:8px}

/* glitch effect for locked values */
.glitch{
  position:relative;
  display:inline-block;
  color:var(--text);
  animation: glitchAnim 1.8s infinite;
}

.glitch:before, .glitch:after{
  content:attr(data-text);
  position:absolute;
  left:0;
  top:0;
  opacity:0.55;
}

.glitch:before{
  color:#5cfccc;
  transform:translate(2px, -1px);
  clip-path: polygon(0 2%, 100% 3%, 100% 20%, 0 18%);
  animation: glitchBefore 1.8s infinite linear alternate-reverse;
}

.glitch:after{
  color:#ff50ad;
  transform:translate(-2px,1px);
  clip-path: polygon(0 70%, 100% 72%, 100% 91%, 0 89%);
  animation: glitchAfter 1.8s infinite linear alternate-reverse;
}

@keyframes glitchAnim{
  0%{ transform:none; }
  25%{ transform:translate(1px, -1px); }
  50%{ transform:translate(-1px,1px); }
  75%{ transform:translate(1px,0px); }
  100%{ transform:none; }
}
@keyframes glitchBefore{
  0%{ transform:translate(2px,-1px); }
  50%{ transform:translate(-2px,1px); }
  100%{ transform:translate(1px,-2px); }
}
@keyframes glitchAfter{
  0%{ transform:translate(-2px,1px); }
  50%{ transform:translate(2px,-1px); }
  100%{ transform:translate(-1px,2px); }
}

/* unlocked state */
.unlocked .value{
  animation:none;
}
.unlocked .value:before,
.unlocked .value:after{
  display:none;
}
</style>
</head>

<body>
<div class="bg-grid"></div>

<div class="wrap">
  <div class="shell">

    <div class="header">
      <div>
        <div class="title"><span class="dash"></span> SCRAP CALC</div>
        <div class="subtitle">Calcula el coste real del scrap â€” versiÃ³n Neon Tech Premium</div>
      </div>
      <div style="font-size:12px;color:var(--muted);font-weight:700;align-self:center">inyec.pro</div>
    </div>

    <div class="area">

      <!-- inputs -->
      <div class="card">
        <div style="font-weight:800;font-size:15px;color:var(--accent);margin-bottom:10px">Entradas</div>

        <div class="inputs-grid">
          <div class="field">
            <label>Piezas / hora</label>
            <input id="pieces" type="number" placeholder="120">
          </div>

          <div class="field">
            <label>Peso pieza (g)</label>
            <input id="weight" type="number" placeholder="34">
          </div>

          <div class="field">
            <label>% Scrap</label>
            <input id="scrap" type="number" step="0.01" placeholder="2.5">
          </div>

          <div class="field">
            <label>Precio â‚¬/kg (granza)</label>
            <input id="price" type="number" step="0.01" placeholder="2.50">
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="calc">Calcular</button>
          <button class="btn ghost" id="reset">Reset</button>
        </div>

        <div class="email-gate">
          <div style="font-weight:700;color:var(--muted);margin-bottom:6px">ðŸ”’ Desbloquea resultados</div>
          <div class="email-row">
            <input id="email" type="email" placeholder="tu@empresa.com">
            <button class="btn" id="unlock">Desbloquear</button>
          </div>

          <div class="consent">
            <input id="consent" type="checkbox">
            <div>Acepto recibir emails de inyec.pro relacionados con contenido tÃ©cnico.</div>
          </div>

          <div class="download">
            <button class="btn ghost" id="download" style="display:none">Descargar CSV</button>
          </div>
        </div>
      </div>

      <!-- results -->
      <div class="card">
        <div style="font-weight:800;font-size:15px;color:var(--accent);margin-bottom:10px">Resultados</div>

        <div class="results-grid">
          <div class="result" id="resH"><div class="label">â‚¬/Hora</div><div class="value glitch" id="vHour" data-text="â€”">â€”</div></div>
          <div class="result" id="resD"><div class="label">â‚¬/DÃ­a (24h)</div><div class="value glitch" id="vDay" data-text="â€”">â€”</div></div>
          <div class="result" id="resM"><div class="label">â‚¬/Mes (30d)</div><div class="value glitch" id="vMonth" data-text="â€”">â€”</div></div>
          <div class="result" id="resY"><div class="label">â‚¬/AÃ±o</div><div class="value glitch" id="vYear" data-text="â€”">â€”</div></div>
        </div>

      </div>

    </div>
  </div>
</div>

<script>
const webhookURL = "https://hook.eu2.make.com/axx0jrw2x1cul6e8shm7hs6ucfg7l6of";

const pieces = document.getElementById("pieces");
const weight = document.getElementById("weight");
const scrap = document.getElementById("scrap");
const price = document.getElementById("price");
const calcBtn = document.getElementById("calc");
const resetBtn = document.getElementById("reset");
const unlockBtn = document.getElementById("unlock");
const emailI = document.getElementById("email");
const consent = document.getElementById("consent");
const downloadBtn = document.getElementById("download");

const vHour = document.getElementById("vHour");
const vDay = document.getElementById("vDay");
const vMonth = document.getElementById("vMonth");
const vYear = document.getElementById("vYear");

let computed = null;

function fmt(v){ return Number(v).toLocaleString('es-ES',{style:'currency',currency:'EUR'}); }

function validate(){
  const p = Number(pieces.value), w = Number(weight.value), s = Number(scrap.value), pr = Number(price.value);
  if(!p || p<=0) return {ok:false,msg:"Piezas / hora invÃ¡lido"};
  if(!w || w<=0) return {ok:false,msg:"Peso pieza invÃ¡lido"};
  if(!s && s!==0) return {ok:false,msg:"Scrap invÃ¡lido"};
  if(s<0 || s>100) return {ok:false,msg:"Scrap entre 0 y 100"};
  if(!pr || pr<=0) return {ok:false,msg:"Precio â‚¬/kg invÃ¡lido"};
  return {ok:true,p,w,s,pr};
}

function computeValues(){
  const x = validate();
  if(!x.ok){ alert(x.msg); return null; }

  const piecesPerHour = x.p;
  const weightKg = x.w / 1000;
  const scrapFrac = x.s / 100;
  const priceKg = x.pr;

  const lostKgHour = piecesPerHour * scrapFrac * weightKg;
  const costHour = lostKgHour * priceKg;
  const costDay = costHour * 24;
  const costMonth = costDay * 30;
  const costYear = costDay * 365;

  return {costHour, costDay, costMonth, costYear};
}

/* show locked glitch */
function showLocked(vals){
  if(!vals) return;
  const show = (el,val) => {
    el.setAttribute("data-text", fmt(val));
    el.textContent = fmt(val);
    el.classList.add("glitch");
  };
  show(vHour, vals.costHour);
  show(vDay, vals.costDay);
  show(vMonth, vals.costMonth);
  show(vYear, vals.costYear);
}

/* unlock animation */
function unlockValues(){
  const animate = (el,end) => {
    el.classList.remove("glitch");
    el.parentElement.classList.add("unlocked");

    let start = 0;
    const steps = 30;
    let c = 0;
    const timer = setInterval(()=>{
      c++;
      const t = c/steps;
      const eased = 1 - Math.pow(1 - t, 3);
      const v = start + (end - start)*eased;
      el.textContent = fmt(v);
      if(c>=steps){ clearInterval(timer); el.textContent = fmt(end); }
    },25);
  };

  animate(vHour, computed.costHour);
  animate(vDay, computed.costDay);
  animate(vMonth, computed.costMonth);
  animate(vYear, computed.costYear);
}

calcBtn.onclick = ()=>{
  const vals = computeValues();
  if(!vals) return;
  computed = vals;
  showLocked(vals);
};

resetBtn.onclick = ()=>{
  pieces.value = weight.value = scrap.value = price.value = "";
  emailI.value = "";
  consent.checked = false;
  computed = null;

  [vHour,vDay,vMonth,vYear].forEach(el=>{
    el.textContent = "â€”";
    el.setAttribute("data-text","â€”");
    el.classList.add("glitch");
  });
};

unlockBtn.onclick = async ()=>{
  if(!computed){ alert("Calcula primero"); return; }
  const mail = emailI.value.trim();
  if(!mail || mail.indexOf("@")<0){ alert("Email invÃ¡lido"); return; }
  if(!consent.checked){ alert("Debes aceptar el consentimiento"); return; }

  unlockBtn.disabled = true;
  unlockBtn.textContent = "Enviando...";

  try{
    await fetch(webhookURL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({email:mail,source:"calculadora_scrap"})
    });
  }catch(e){}

  setTimeout(()=>{
    unlockBtn.disabled = false;
    unlockBtn.textContent = "Desbloquear";
  },700);

  unlockValues();
  downloadBtn.style.display="inline-block";
};

downloadBtn.onclick = ()=>{
  if(!computed) return;
  const rows = [
    ["MÃ©trica","Valor (â‚¬)"],
    ["Coste / Hora", computed.costHour.toFixed(2)],
    ["Coste / DÃ­a (24h)", computed.costDay.toFixed(2)],
    ["Coste / Mes (30d)", computed.costMonth.toFixed(2)],
    ["Coste / AÃ±o", computed.costYear.toFixed(2)]
  ];
  const csv = rows.map(r=>r.join(",")).join("\n");
  const blob = new Blob([csv],{type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url; a.download="informe_scrap.csv";
  document.body.appendChild(a);
  a.click();
  a.remove();
};
</script>
</body>
</html>
